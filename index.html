<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hi I'm a tab! :O</title>
<style>
  /* ◾ 1. DARK THEME ROOT COLORS ---------------------------------------- */
  :root{
    --bg:        #121212;   /* page */
    --card-dark: #1e1e1e;   /* default tile */
    --card-light:#fafafa;   /* fallback tile for dark loaders */
    --text:      #eee;      /* headings */
    --subtext:   #666;      /* filenames on light cards */
  }

  /* ◾ 2. LAYOUT --------------------------------------------------------- */
  body{font-family:sans-serif;background:var(--bg);color:var(--text);margin:0;padding:2rem}
  h1{text-align:center;margin-bottom:1.5rem}
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(130px,1fr));
    gap:1rem;
  }
  .card{
    background:var(--card-dark);
    border-radius:8px;
    padding:.5rem;
    box-shadow:0 2px 6px rgba(0,0,0,.6);
    text-align:center;
    transition:background .3s;
  }
  .card.light-card{         /* activated for black loaders */
    background:var(--card-light);
  }

  .name{
    font-size:.7rem;
    margin-top:.4rem;
    word-break:break-all;
    color:var(--subtext);
  }

  /* ◾ 3. MEDIA ---------------------------------------------------------- */
  .card img,.card video{
    display:block;margin:0 auto;
    max-width:100%;max-height:120px;
  }
  .spin{animation:spin 6s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<h1>Elliot’s Loading Bar Museum</h1>
<div id="gallery" class="grid"></div>

<script>
/* ==== CONFIG ==== */
const owner = "Elliotisnt";
const repo  = "loading-bars";
const path  = "Waiting%20Bar%20Collection";

const ALLOWED  = /\.(gif|apng|webm|svg|png|jpe?g)$/i;
const ANIMATED = /\.(gif|apng|webm)$/i;

/* tiny canvas reused to sample brightness */
const probe = document.createElement("canvas");
probe.width = probe.height = 1;
const ctx = probe.getContext("2d");

function isDark(img){
  try{
    ctx.clearRect(0,0,1,1);
    ctx.drawImage(img,0,0,1,1);          // shrink to 1×1
    const [r,g,b] = ctx.getImageData(0,0,1,1).data;
    const lum = 0.2126*r + 0.7152*g + 0.0722*b;  // perceived brightness
    return lum < 60;                              // tweak threshold as needed
  }catch{
    return false; // CORS fallback
  }
}

/* ==== RENDER ==== */
(async ()=>{
  const res  = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`);
  const list = await res.json();
  const gallery = document.getElementById("gallery");

  list.filter(f=>ALLOWED.test(f.name)).forEach(file=>{
    const card = document.createElement("div");
    card.className = "card";

    let media;
    if (/\.webm$/i.test(file.name)){
      media = document.createElement("video");
      Object.assign(media,{src:file.download_url,autoplay:true,loop:true,muted:true});
      // videos are usually coloured; leave card dark
    } else {
      media = document.createElement("img");
      media.crossOrigin = "anonymous";   // allow canvas sampling
      media.src = file.download_url;
      media.onload = ()=>{               // decide card tone after load
        if (isDark(media)){ card.classList.add("light-card"); }
      };
      if (!ANIMATED.test(file.name)) media.classList.add("spin");
    }

    const cap = document.createElement("div");
    cap.className = "name";
    cap.textContent = file.name;

    card.append(media,cap);
    gallery.append(card);
  });
})();
</script>
</body>
</html>
